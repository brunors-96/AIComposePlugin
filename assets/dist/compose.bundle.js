(()=>{"use strict";var n={56:(n,e,t)=>{n.exports=function(n){var e=t.nc;e&&n.setAttribute("nonce",e)}},72:n=>{var e=[];function t(n){for(var t=-1,i=0;i<e.length;i++)if(e[i].identifier===n){t=i;break}return t}function i(n,i){for(var r={},a=[],l=0;l<n.length;l++){var c=n[l],s=i.base?c[0]+i.base:c[0],u=r[s]||0,d="".concat(s," ").concat(u);r[s]=u+1;var p=t(d),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==p)e[p].references++,e[p].updater(m);else{var f=o(m,i);i.byIndex=l,e.splice(l,0,{identifier:d,updater:f,references:1})}a.push(d)}return a}function o(n,e){var t=e.domAPI(e);return t.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;t.update(n=e)}else t.remove()}}n.exports=function(n,o){var r=i(n=n||[],o=o||{});return function(n){n=n||[];for(var a=0;a<r.length;a++){var l=t(r[a]);e[l].references--}for(var c=i(n,o),s=0;s<r.length;s++){var u=t(r[s]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=c}}},113:n=>{n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},314:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t="",i=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),i&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),i&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t}).join("")},e.i=function(n,t,i,o,r){"string"==typeof n&&(n=[[null,n,void 0]]);var a={};if(i)for(var l=0;l<this.length;l++){var c=this[l][0];null!=c&&(a[c]=!0)}for(var s=0;s<n.length;s++){var u=[].concat(n[s]);i&&a[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},540:n=>{n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601:n=>{n.exports=function(n){return n[1]}},659:n=>{var e={};n.exports=function(n,t){var i=function(n){if(void 0===e[n]){var t=document.querySelector(n);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(n){t=null}e[n]=t}return e[n]}(n);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}},686:(n,e,t)=>{t.d(e,{A:()=>l});var i=t(601),o=t.n(i),r=t(314),a=t.n(r)()(o());a.push([n.id,'.xinfo {\n  display: inline-block;\n  position: relative;\n}\n.xinfo.right div {\n  right: auto;\n\n}\n.xinfo.top div {\n  top: auto;\n  bottom: 20px;\n}\n.xinfo:hover div {\n  display: block;\n  z-index: 99;\n}\n.xinfo::before {\n  font-family: Icons;\n  font-style: normal;\n  font-weight: 900;\n  text-decoration: inherit;\n  text-align: center;\n  content: "\\f05a";\n  z-index:3;\n}\n\n#aic-generate-email-button-clone:before{\n  content: "\\f544";\n}\n\n.xinfo div {\n  font-family: Roboto, sans-serif;\n  font-size: 1.1rem;\n  position: absolute;\n  display: none;\n  right: 0;\n  text-align: left;\n  min-width: 200px;\n  max-width: 300px;\n  font-weight: normal;\n  top: 20px;\n  padding: 8px;\n  border-radius: 5px;\n  white-space: normal;\n  background-color: #fff;\n  border: 1px solid #d4dbde;\n  box-shadow: 3px 3px 5px #dcdedf;\n}\nhtml.dark-mode .xinfo div {\n  background-color: #161b1d;\n  border-color: #4d6066;\n  box-shadow: none;\n}\n\n.dark-mode .xdialog-mask {\n  background: rgba(0, 0, 0, 0.7);\n}\n.xdialog-mask {\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.5);\n  z-index: 99;\n}\n.xdialog-mask .xdialog-box {\n  display: flex;\n  flex-direction: column;\n  margin: 20% auto 0 auto;\n  max-width: 460px;\n  max-height: 90%;\n  box-sizing: border-box;\n  text-align: center;\n  border: 1px solid;\n  border-color: #ddd;\n  background-color: #fff;\n  background-color: rgba(255, 255, 255, 0.8);\n  backdrop-filter: blur(10px);\n}\nhtml.dark-mode .xdialog-mask .xdialog-box {\n  border-color: #4d6066;\n}\nhtml.dark-mode .xdialog-mask .xdialog-box {\n  background-color: #21292c;\n}\n.xdialog-mask .xdialog-box.full-screen {\n  position: fixed;\n  max-width: None;\n  margin: 0;\n  max-height: none;\n  top: 5%;\n  left: 5%;\n  right: 5%;\n  bottom: 5%;\n}\n\n.xdialog-mask .xdialog-box .xdialog-title {\n  flex: 0 0 auto;\n  position: relative;\n  padding: 1rem;\n  text-align: left;\n  font-size: 1.25rem;\n  font-weight: bold;\n  border-bottom: 1px solid;\n  border-color: #ddd;\n  backdrop-filter: blur(10px);\n}\nhtml.dark-mode .xdialog-mask .xdialog-box .xdialog-title {\n  border-color: #4d6066;\n}\n.xdialog-mask .xdialog-box .xdialog-title .xdialog-close {\n  position: absolute;\n  right: 1rem;\n  border: none !important;\n  font-size: 2rem;\n  padding: 0;\n  margin: 0;\n  background: transparent !important;\n}\n.xdialog-mask .xdialog-box .xdialog-contents {\n  flex: 1 1 auto;\n  padding: 1rem;\n  text-align: left;\n}\n\n\n\nbody.xlarry:not(.xskin) #button-apps:before,\nbody.xlarry:not(.xskin) #sections-table tr > td.section:before,\nbody.xlarry:not(.xskin) #settings-tabs a.x2fa:before,\nbody.xlarry:not(.xskin) #settings-tabs a.xcpanel-settings:before,\nbody.xlarry:not(.xskin) .listing.iconized li > a:before {\n  display: none !important;\n}\n\n.formcontent input.button,\n.formcontent input[type="checkbox"] {\n  width: auto;\n}\n.listing.iconized li a:before,\n.listing.iconized tr td:before {\n  margin-right: 0.5rem;\n}\n\n#aic-compose-dialog #aic-compose-dialog-box > .xdialog-contents {\n  overflow-y: auto;\n  display: flex;\n  flex-flow: column;\n  position: relative;\n  padding: 0;\n}\n#aic-compose-dialog #aic-compose-dialog-box > .xdialog-contents .btn-default {\n  border-color: #ddd;\n}\nhtml.dark-mode\n  #aic-compose-dialog\n  #aic-compose-dialog-box\n  > .xdialog-contents\n  .btn-default {\n  border-color: #4d6066;\n}\n#aic-compose-dialog #aic-compose-dialog-box > .xdialog-contents .xspinner {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  font-size: 3em;\n  margin: -1.5em 0 -1.5em 0;\n  color: #777;\n}\n\n\n#aic-compose-dialog #aic-compose-dialog-box #aic-compose-help .help-content li {\n  margin-bottom: 0.5rem;\n}\n\n\n\n.xdialog-mask .xdialog-box .xdialog-title .xdialog-close {\n  position: absolute;\n  right: 1rem;\n  top: 50%;\n  transform: translateY(-52%);\n  border: none !important;\n  font-size: 2rem;\n  padding: 0;\n  margin: 0;\n  color: #26262e;\n}\n\nhtml.dark-mode .xdialog-mask .xdialog-box .xdialog-title .xdialog-close {\n  color: #c5d1d3;\n}\n\n\nbody.xlarry #aic-compose-dialog #aic-compose-dialog-box .xdialog-close {\n  line-height: 1.3rem;\n  background: transparent !important;\n}\n\n\n#fix-text-tooltip{\n    position: absolute;\n    background-color: #f1f3f4;\n    border: 1px solid rgb(204, 204, 204);\n    padding: 8px; border-radius: 4px;\n    box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 5px;\n    left: 168px;\n    top: 363px;\n    display: none;\n  align-items: center;\n  flex-direction: column;\n  width: 20vw;\n  z-index: 99;\n}\n\nhtml.dark-mode #fix-text-tooltip{\n  background-color: #21292c;\n}\n\n\n\n#aic-fix-text-section{\n  height: 100%;\n}\n\n\n.xdialog-contents{\n  overflow-y: scroll;\n}\n\n#aic-compose-help-modal{\n  width: 70%;\n  height:85%;\n  margin: auto;\n}\n\n.help-header{\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  width: 100%;\n}\n\n.aic-back-button{\npadding: 7px 15px;\n}\n\n#help-title{\nmargin: 0 auto;\n}\n\n.help-content p{\n  padding-top: 20px;\n  font-size: 1.2rem;\n}\n\n.help-content ul li {\n  margin-bottom: 7px;\n  font-size: 1.1rem;\n}\n\n.help-content ul li:last-child {\n  margin-bottom: 0;\n}\n\n\n.select-div{\n  display:flex;\n  flex-direction: column;\n  gap:12px;\n  align-items: center;\n}\n\n.single-select{\n  width:95%;\n  display : flex;\n}\n\n.select-label{\n  padding: 5px 5px 5px 0;\n  hyphens: auto;\n\n  margin-bottom: 0;\n  flex: 0 0 50%;\n  max-width: 50%;\n}\n\n.select-option{\n  flex: 0 0 50%;\n  max-width: 50%;\n}\n\n.menu a#switch-task-predefined-instructions::before{\n content: "\\f013";\n}\n\n.menuitem a.recipient:before{\n  content: "\\f4ad" !important;\n}\n#header-div{\n  text-align: center;\n  padding:5px 5px 12px;\n  border-top:1px solid #7c949c;\n}\n\n#aic-instruction{\n  width: 90%;\n  box-sizing: border-box;\n}\n\n#aic-popup::before{\n  content: "\\f4ad";\n}\n\n#aic-popup:focus{\n  outline:none;\n  box-shadow: none;\n  border-color:#7c949c;\n}\n\n#aic-example-instructions::before{\n  content: "\\f05a";\n}\n\n\n#aic-example-instructions:hover{\nbackground-color: #374549;\n}\n\n\n#custom-input-group{\n  flex-wrap: nowrap;\n}\n\n.formbutton{\n  padding: 7px 6px;\n}\n\n#aic-instruction-label{\n  text-overflow: ellipsis;\n  overflow: visible;\n}\n\n\n@media  (min-width: 2100px) {\n  #fix-text-tooltip {\n    width: 17vw !important;\n  }\n}\n\n@media (max-width: 2100px) and (min-width: 1800px) {\n  #fix-text-tooltip {\n    width: 19vw !important;\n  }\n}\n@media (max-width: 1800px) and (min-width: 1500px){\n  #fix-text-tooltip{\n    width: 21vw!important;\n  }\n\n}\n\n@media (max-width: 1500px) and (min-width: 1200px){\n  #fix-text-tooltip{\n    width: 23vw!important;\n  }\n\n}\n\n@media (max-width: 900px) and (min-width: 700px){\n  #fix-text-tooltip{\n    width: 27vw!important;\n  }\n\n}\n\n\n\n@media (max-width: 700px) and (min-width: 600px){\n  #fix-text-tooltip{\n    width: 33vw!important;\n  }\n\n}\n\n\n@media (max-width: 600px) and (min-width: 500px){\n  #fix-text-tooltip{\n    width: 40vw!important;\n  }\n\n}\n\n@media (max-width: 500px) {\n  #fix-text-tooltip{\n    width: 55vw!important;\n  }\n\n  #aic-compose-help > div.help-content > p{\n    text-align: center;\n  }\n}\n\n@media (max-width: 1068px) and (min-width: 350px) {\n  .xinfo {\n    display: none;\n  }\n\n  #aic-instruction-label{\n    overflow: hidden;\n  }\n}\n\n@media (max-width: 350px) {\n  .xinfo {\n    display: none;\n  }\n  .xdialog-mask .xdialog-box.full-screen {\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n  }\n  #aic-instruction-label{\n    overflow: hidden;\n  }\n}\n',""]);const l=a},825:n=>{n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(t){!function(n,e,t){var i="";t.supports&&(i+="@supports (".concat(t.supports,") {")),t.media&&(i+="@media ".concat(t.media," {"));var o=void 0!==t.layer;o&&(i+="@layer".concat(t.layer.length>0?" ".concat(t.layer):""," {")),i+=t.css,o&&(i+="}"),t.media&&(i+="}"),t.supports&&(i+="}");var r=t.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,n,e.options)}(e,n,t)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function t(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={id:i,exports:{}};return n[i](r,r.exports,t),r.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var i in e)t.o(e,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.nc=void 0;var i=t(72),o=t.n(i),r=t(825),a=t.n(r),l=t(659),c=t.n(l),s=t(56),u=t.n(s),d=t(540),p=t.n(d),m=t(113),f=t.n(m),x=t(686),h={};function g(n){return rcmail.gettext("AIComposePlugin."+n)}function v(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}function b(n){return n.replace(/\\n/g,"\n").replace(/\s+/g," ").trim()}function y(n){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},y(n)}function w(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,T(i.key),i)}}function E(n,e,t){return e&&w(n.prototype,e),t&&w(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function T(n){var e=function(n){if("object"!=y(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=y(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==y(e)?e:e+""}function k(n,e,t){if("function"==typeof n?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}h.styleTagTransform=f(),h.setAttributes=u(),h.insert=c().bind(null,"head"),h.domAPI=a(),h.insertStyleElement=p(),o()(x.A,h),x.A&&x.A.locals&&x.A.locals;var S,C=new WeakSet,I=E(function n(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(n,e){(function(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")})(n,e),e.add(n)}(this,C),k(C,this,_).call(this),document.getElementById("aic-example-instructions").title=g("ai_help_title")});function _(){rcube_webmail.prototype.openhelpexamples=k(C,this,j),rcube_webmail.prototype.closehelpexamples=k(C,this,P),rcmail.enable_command("openhelpexamples",!0),rcmail.register_command("openhelpexamples"),rcmail.enable_command("closehelpexamples",!0),rcmail.register_command("closehelpexamples")}function j(){document.getElementById("aic-compose-help-modal-mask").removeAttribute("hidden")}function P(){document.getElementById("aic-compose-help-modal-mask").setAttribute("hidden","hidden")}var B="",A=!1,L=!1;function M(n){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},M(n)}function H(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,O(i.key),i)}}function O(n){var e=function(n){if("object"!=M(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=M(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==M(e)?e:e+""}function z(n,e,t){if("function"==typeof n?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}rcmail.addEventListener("editor-load",function(n){var e;S=null==n||null===(e=n.ref)||void 0===e?void 0:e.editor});var N,R,q=new WeakSet,F=function(){return n=function n(){if(function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(n,e){(function(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")})(n,e),e.add(n)}(this,q),n.instance)return n.instance;this.popup=document.getElementById("fix-text-tooltip"),this.instructionTextArea=document.getElementById("aic-instruction"),this.textarea=document.getElementById("composebody"),this.selectedText="",this.editorHTML=null,z(q,this,G).call(this),n.instance=this},(e=[{key:"getSelectedText",value:function(){return this.selectedText}},{key:"isHTMLEditor",value:function(){return!(!this.editorHTML||!tinymce.activeEditor)}}])&&H(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e}();function G(){z(q,this,W).call(this),z(q,this,Y).call(this)}function W(){var n=this;""===this.instructionTextArea.value&&document.getElementById("aic-generate-email-button").setAttribute("disabled","disabled"),this.instructionTextArea.addEventListener("input",function(){""===n.instructionTextArea.value?document.getElementById("aic-generate-email-button").setAttribute("disabled","disabled"):(document.getElementById("aic-generate-email-button").removeAttribute("disabled"),rcmail.enable_command("generatemail",!0))})}function Y(){var n=this;this.textarea.addEventListener("mouseup",function(e){z(q,n,U).call(n,e.clientX,e.clientY)}),this.textarea.addEventListener("contextmenu",function(e){z(q,n,U).call(n,e.clientX,e.clientY)}),document.addEventListener("click",function(e){n.textarea.contains(e.target)||n.popup.contains(e.target)||(n.popup.style.display="none")}),rcmail.addEventListener("editor-load",function(e){var t;n.editorHTML=null==e||null===(t=e.ref)||void 0===t?void 0:t.editor,tinymce.activeEditor&&z(q,n,$).call(n)})}function U(n,e){var t,i;this.isHTMLEditor()||(t=this.textarea.selectionStart,i=this.textarea.selectionEnd),document.getElementById("fix-text-aic-instruction").value="";var o=z(q,this,X).call(this)?this.textarea.value.substring(t,i):"";this.selectedText=this.isHTMLEditor()?z(q,this,X).call(this)?z(q,this,D).call(this):"":o,z(q,this,X).call(this)?(this.popup.style.left="".concat(n,"px"),this.popup.style.top="".concat(e,"px"),A&&(this.popup.style.display="flex")):this.popup.style.display="none"}function D(){return this.editorHTML.selection.getContent({format:"text"})}function X(){return this.isHTMLEditor()?""!==this.editorHTML.selection.getContent({format:"text"}):this.textarea.selectionStart!==this.textarea.selectionEnd}function $(){var n=this;this.editorHTML.on("click keyup",function(){z(q,n,J).call(n)}),this.editorHTML.on("contextmenu",function(){z(q,n,J).call(n)})}function J(){var n=document.querySelector("#compose-content > form > div.form-group.row"),e=n.getBoundingClientRect(),t=e.top+n.clientHeight+parseFloat(window.getComputedStyle(n).marginBottom),i=e.left;this.popup.style.display="flex";var o=parseFloat(.7*document.getElementById("fix-text-tooltip").clientHeight);this.popup.style.display="none";var r=tinymce.activeEditor.selection.getRng();if(r){var a=r.getBoundingClientRect();z(q,this,U).call(this,i+a.left+window.scrollX,t+a.top+window.scrollY+o)}}function K(){var n=document.querySelector("ul.form-control.recipient-input.ac-input.rounded-left.ui-sortable li.input input"),e=document.querySelector("#compose_to > div > div > ul").querySelectorAll("li.recipient"),t=[];e.forEach(function(n){var e,i=n.querySelector("span.name"),o=n.querySelector("span.email"),r={name:i?i.textContent.trim():"",email:o&&(null===(e=o.textContent.match(/<([^>]+)>/))||void 0===e||null===(e=e[1])||void 0===e?void 0:e.trim())||""};V(r.name,r.email,t)});var i="",o="";if(""!==n.value&&n.value.includes("@")){var r=(o=n.value).split("@")[0].split(".");if(r.length>=2){var a=v(r[0]),l=v(r[1]);i="".concat(a," ").concat(l)}}else i=n.value.split(" ").map(function(n){return v(n)}).join(" ");return V(i,o,t),t}function Q(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"name";return e="name"!==e&&"email"!==e?"name":e,n.map(function(n){return n[e]}).join(", ")}function V(n,e,t){(n||e)&&t.push({name:n,email:e})}function Z(){var n,e=document.querySelector("a.iconlink.input-group-text");return e?(n=e.classList.contains("custom-from-on")?document.getElementById("_from"):document.querySelector("input.custom_from.form-control"),e.classList.contains("custom-from-on")?n.options[n.selectedIndex].textContent:n.value):(n=document.querySelector(".input-group select#_from"))[n.selectedIndex].textContent}function nn(n){var e="",t="",i=n.match(/^(.+?)\s+<(.+?)>$/);if(i)e=i[1].trim().split(" ").map(function(n){return v(n)}).join(" "),t=i[2].trim().replace(/[<>]/g,"").trim();else if(n.includes("@")){var o=(t=n.replace(/[<>]/g,"").trim()).split("@")[0].split(".");e=o.length>1?o.map(function(n){return v(n)}).join(" "):v(o[0])}else e=n.trim();return{senderName:"".concat(e),senderEmail:"".concat(t)}}N=F,(R=O(R="instance"))in N?Object.defineProperty(N,R,{value:null,enumerable:!0,configurable:!0,writable:!0}):N[R]=null;var en="",tn="";function on(n){return n.split("\n").filter(function(n){return""!==n.trim()}).map(function(n){return n.trim()}).join("\n")}function rn(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,i=Array(e);t<e;t++)i[t]=n[t];return i}function an(n){return an="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},an(n)}function ln(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,sn(i.key),i)}}function cn(n,e,t){return e&&ln(n.prototype,e),t&&ln(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function sn(n){var e=function(n){if("object"!=an(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=an(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==an(e)?e:e+""}function un(n,e,t){if("function"==typeof n?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}rcmail.addEventListener("editor-load",function(n){var e;en=null==n||null===(e=n.ref)||void 0===e?void 0:e.editor});var dn=new WeakSet,pn=cn(function n(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(n,e){(function(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")})(n,e),e.add(n)}(this,dn),this.predefinedInstructions=document.querySelector("#predefined-instructions-dropdown"),un(dn,this,mn).call(this)});function mn(){rcube_webmail.prototype.generatemail=un(dn,this,fn),rcmail.register_command("generatemail"),un(dn,this,xn).call(this),un(dn,this,hn).call(this),document.getElementById("aic-generate-email-button").title=g("ai_generate_email")}function fn(){var n,e,t,i,o,r,a,l,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,s=(n=document.getElementById("aic_style_select"),e=document.getElementById("aic_length_select"),t=document.getElementById("aic_creativity_select"),i=document.getElementById("aic_language_select"),o=nn(Z()),r=document.getElementById("aic-instruction"),a=Q(K(),"name"),l=Q(K(),"email"),{style:"".concat((null==n?void 0:n.value)||rcmail.env.aiPluginOptions.defaultStyle),senderName:"".concat((null==o?void 0:o.senderName)||""),recipientName:"".concat(a||""),length:"".concat((null==e?void 0:e.value)||rcmail.env.aiPluginOptions.defaultLength),creativity:"".concat((null==t?void 0:t.value)||rcmail.env.aiPluginOptions.defaultCreativity),language:"".concat((null==i?void 0:i.value)||rcmail.env.aiPluginOptions.defaultLanguage),subject:"".concat(document.getElementById("compose-subject").value),recipientEmail:"".concat(l),senderEmail:"".concat(o.senderEmail),instructions:"".concat(r.value),previousConversation:"",fixText:"",previousGeneratedEmailText:"",multipleRecipients:K().length>1?"yes":""});s.previousGeneratedEmail=function(n){if(/[<>&"']/.test(n)){var e=document.createElement("div");e.innerHTML=n,n=e.textContent.replace(/<br\s*\/?>/gi,"").replace(/\s+/g," ").replace(/\n/g,"").replace(/\s{2,}/g,"").trim()}return n}("".concat(B));var u=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(en.editorContainer){var e=en.getContent({format:"html"}),t=document.createElement("div");t.innerHTML=e,e=(e=t.textContent).replace(n,""),tn=b(on(e))}else{var i=b(document.getElementById("composebody").value.replace(n,""));tn=on(i)}var o=function(n){for(var e=0,t=Object.keys(rcmail.env.signatures);e<t.length;e++){var i=t[e],o=void 0;if(en.editorContainer){var r=document.createElement("div");r.innerHTML=rcmail.env.signatures[i].html,o=b(on(r.textContent))}else o=b(on(rcmail.env.signatures[i].text));if(n.includes(o))return o}return null}(tn);if(o){var r=tn.indexOf(o),a=r+o.length;return{previousConversation:"".concat(tn.slice(0,r)+tn.slice(a)),signaturePresent:"present"}}return{previousConversation:"".concat(tn),signaturePresent:""}}(s.previousGeneratedEmail);s.previousConversation=u.previousConversation,s.signaturePresent=u.signaturePresent,s.instructions=c?""===c.passedInstruction?s.instructions:c.passedInstruction:s.instructions,s.fixText=c?c.fixText:"";var d,p=(d=[],""===nn(Z()).senderName&&d.push({text:g("ai_error_sender_name"),type:"error"}),""===Q(K(),"name")&&d.push({text:g("ai_error_recipient_name"),type:"warning"}),d);0!==p.length&&p.forEach(function(n){rcmail.display_message(n.text,n.type)}),function(n){var e,t=function(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(n,e){if(n){if("string"==typeof n)return rn(n,e);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?rn(n,e):void 0}}(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var i=0,o=function(){};return{s:o,n:function(){return i>=n.length?{done:!0}:{done:!1,value:n[i++]}},e:function(n){throw n},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,l=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return a=n.done,n},e:function(n){l=!0,r=n},f:function(){try{a||null==t.return||t.return()}finally{if(l)throw r}}}}(n);try{for(t.s();!(e=t.n()).done;)if("error"===e.value.type)return!0}catch(n){t.e(n)}finally{t.f()}return!1}(p)||(rcmail.lock_frame(document.body),rcmail.http_post("plugin.AIComposePlugin_GenerateEmailAction",{senderName:"".concat(s.senderName),recipientName:"".concat(s.recipientName),instructions:"".concat(s.instructions),style:"".concat(s.style),length:"".concat(s.length),creativity:"".concat(s.creativity),language:"".concat(s.language),previousConversation:"".concat(s.previousConversation),signaturePresent:"".concat(s.signaturePresent),previousGeneratedEmailText:"".concat(s.previousGeneratedEmail),fixText:"".concat(s.fixText),recipientEmail:"".concat(s.recipientEmail),senderEmail:"".concat(s.senderEmail),subject:"".concat(s.subject),multipleRecipients:"".concat(s.multipleRecipients)},!0).done(function(n){(function(n){var e=document.getElementById("composebody"),t=n;if(S&&tinymce.activeEditor){var i;t=n.replace(/\n/g,"<br>");var o=null===(i=tinymce)||void 0===i||null===(i=i.activeEditor)||void 0===i?void 0:i.dom.decode(S.getContent()).replace(B,"");S.setContent("".concat(t).concat(o)),B="<p>".concat(t.replace(/<br>/g,"<br />"),"</p>")}else e.value=e.value.replace(B,""),e.value="".concat(n).concat(e.value),B=n;L||(A=!0,L=!0)})(n&&void 0!==n.respond?n.respond:"");var e=document.getElementById("aic-instruction");e.value=null===c||""===c.fixText?s.instructions:e.value}).always(function(){rcmail.unlock_frame()}))}function xn(){Array.from(this.predefinedInstructions.children).forEach(function(n){if(!n.hasAttribute("role")){var e=rcmail.env.aiPredefinedInstructions.find(function(e){return e.id===n.id.replace("dropdown-","")});n.onclick=function(){rcmail.enable_command("generatemail",!0);var n={passedInstruction:e.message,fixText:""};return rcmail.command("generatemail",n)}}})}function hn(){var n=document.getElementsByClassName("help-a");Array.from(n).forEach(function(n){n.onclick=function(){document.getElementById("aic-compose-help-modal-mask").setAttribute("hidden","hidden"),rcmail.enable_command("generatemail",!0);var e={passedInstruction:n.previousElementSibling.textContent,fixText:""};return rcmail.command("generatemail",e)}})}function gn(n){return gn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},gn(n)}function vn(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,yn(i.key),i)}}function bn(n,e,t){return e&&vn(n.prototype,e),t&&vn(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function yn(n){var e=function(n){if("object"!=gn(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var t=e.call(n,"string");if("object"!=gn(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==gn(e)?e:e+""}function wn(n,e,t){if("function"==typeof n?n===e:n.has(e))return arguments.length<3?e:t;throw new TypeError("Private element is not present on this object")}var En=new WeakSet,Tn=bn(function n(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),function(n,e){(function(n,e){if(e.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")})(n,e),e.add(n)}(this,En),this.fixTextTextarea=document.getElementById("fix-text-aic-instruction"),this.sendButton=document.getElementById("fix-text-send"),wn(En,this,kn).call(this)});function kn(){rcube_webmail.prototype.prepareFixTextRequest=wn(En,this,Cn).bind(this),rcmail.register_command("prepareFixTextRequest"),wn(En,this,In).call(this)}function Sn(){""!==this.fixTextTextarea.value?(rcmail.enable_command("prepareFixTextRequest",!0),this.sendButton.removeAttribute("disabled")):this.sendButton.setAttribute("disabled","disabled")}function Cn(){if(""!==this.fixTextTextarea.value){var n=(new F).getSelectedText(),e={passedInstruction:this.fixTextTextarea.value,fixText:n};return document.getElementById("fix-text-tooltip").style.display="none",rcmail.command("generatemail",e)}}function In(){var n=this;this.fixTextTextarea.addEventListener("input",function(){wn(En,n,Sn).call(n)})}document.addEventListener("DOMContentLoaded",function(){new I,new F,new pn,new Tn,function(){var n,e=document.getElementById("aic-instruction"),t=new Date;t.setFullYear(t.getFullYear()+1);var i=new Date(t).toUTCString();new ResizeObserver(function(){n&&clearTimeout(n),n=setTimeout(function(){document.cookie="textareaHeight=".concat(e.getBoundingClientRect().height,"; expires=").concat(i,"; path=/")},200)}).observe(e)}(),function(){var n=document.getElementById("aic-instruction");n.style.overflow="hidden";var e=document.createElement("div");e.style.position="absolute",e.style.visibility="hidden",e.style.whiteSpace="pre-wrap",e.style.overflowWrap="break-word",document.body.appendChild(e);var t=parseFloat(window.getComputedStyle(n).lineHeight);n.addEventListener("input",function(i){var o,r,a;o=n,r=e,a=window.getComputedStyle(o),r.style.font=a.font,r.style.padding=a.padding,r.style.border=a.border,r.style.width="".concat(o.offsetWidth,"px"),r.style.lineHeight=a.lineHeight;var l=n.getBoundingClientRect().height,c=n.value,s=n.selectionStart;e.textContent=c.substring(0,s);var u=Math.floor(n.scrollHeight/t);2===u&&function(n,e){return e<=2*n}(t,l)?(n.style.height=l+t+"px",n.style.overflow="auto"):1===u&&(n.style.overflow="hidden")})}()})})();
